<div>
  <div class="input-prepend input-append">
    <span class="btn-group">
      <button type="button"
              class="btn cursor-button"
              title="Node cursor"
              ng:class="{'btn-primary': node.isCursor(),
                        'btn-default': ! node.isCursor()}"
              ng:focus="node.cursorTo()">
        <span class="icon-th">
        </span>
      </button>
      <button type="button"
              class="btn btn-default norg-node-collapse-button"
              title="Expand/Collapse this node's children"
              ng:disabled="! node.$length"
              ng:click="node.$collapsed = !node.$collapsed"
              ng:focus="node.cursorTo()">
        <span ng:class="{'icon-chevron-down': node.$length && node.$collapsed,
                        'icon-chevron-up': !(node.$length && node.$collapsed),
                        'icon-chevron-up': !(node.$length && node.$collapsed),
                        'muted': ! node.$length}">
        </span>
      </button>
      <button type="button"
              class="btn btn-default norg-headers-expand"
              title="Expand/Collapse headers/fields"
              ng:disabled="! node.$headerKeys().length"
              ng:click="node.$headersCollapsed = !node.$headersCollapsed"
              ng:focus="node.cursorTo()">
        <span class="icon-th-list"
              ng:class="{'text-muted':
                        ! node.$headerKeys().length}">
        </span>
      </button>
      <button type="button"
              class="btn btn-default norg-node-select"
              title="Select this node for multi-node actions"
              ng:focus="node.cursorTo()">
        <input type="checkbox" name="Message-ID-{{node.toId()}}"
               ng:focus="node.cursorTo()" />
      </button>
    </span>

    <input type="text" required="true"
           class="norg-node-subject input-xxlarge"
           name="Message-ID-{{node.toId()}}-headers-Subject"
           ng:model="node['Subject']"
           norg:focus="{{node.isCursor()}}" />

    <span class="btn-group">
      <button type="button"
              class="btn btn-default norg-add-node"
              title="Add a new node"
              ng:click="node.newSibling($event, {})">
        <span class="icon-plus"></span>
      </button>
      <button type="button"
              class="btn btn-default promote"
              title="Promote this node"
              ng:disabled="! node.$parent.$parent"
              ng:click="node.promote()"
              ng:focus="node.cursorTo()">
        <span class="icon-arrow-left"
              ng:class="{'muted': ! node.$parent.$parent}"></span>
      </button>
      <button type="button"
              class="btn btn-default norg-demote-node"
              title="Demote this node"
              ng:disabled="! node.$prevSibling"
              ng:click="node.demote()"
              ng:focus="node.cursorTo()">
        <span class="icon-arrow-right"
              ng:class="{'muted': ! node.$prevSibling}"></span>
      </button>
      <button type="button"
              class="btn btn-default norg-move-up-node"
              title="Move this node up"
              ng:disabled="! node.$prevSibling"
              ng:click="node.moveUp()"
              ng:focus="node.cursorTo()">
        <span class="icon-arrow-up"
              ng:class="{'muted': ! node.$prevSibling}"></span>
      </button>
      <button type="button"
              class="btn btn-default norg-move-down-node"
              title="Move this node down"
              ng:disabled="! node.$nextSibling"
              ng:click="node.moveDown()"
              ng:focus="node.cursorTo()">
        <span class="icon-arrow-down"
              ng:class="{'muted': ! node.$nextSibling}"></span>
      </button>
    </span>
  </div>

  <div id="Message-ID-{{node.toId()}}-headers"
       class="norg-headers"
       collapse="node.$headersCollapsed">
    <div class="row-fluid"
         ng:repeat="(index, key) in node.$headerKeys()">
      <div class="input-prepend">
        <button type="button"
                class="btn norg-cursor-button"
                ng:class="{'btn-primary': node.isCursor(node, index),
                          'btn-default': ! node.isCursor(node, index)}"
                title="Node cursor"
                ng:click="node.cursorTo(node, index)">
          <span class="icon-th">
          </span>
        </button>
        <input type="text" required="true" class="norg-headers-key"
               name="Message-ID-{{node.toId()}}-header-key-{{key}}"
               ng:model="key"
               ng:focus="node.cursorTo(node, index)" />
      </div>
      <div class="input-prepend input-append">
        <input type="text" class="input-xlarge"
               name="Message-ID-{{node.toId()}}-header-value-{{key}}"
               ng:model="node[key]"
               ng:focus="node.cursorTo(node, index)"
               norg:focus="{{node.isCursor(node, index)}}" />
      </div>
    </div>
  </div>

  <ol id="children" class="norg-nodes" collapse="node.$collapsed">
    <li ng:repeat="node in node.children()"
        ui:keydown="keydown"
        id="Message-ID-{{node.toId()}}"
        class="norg-node row-fluid">
      <span ng:include="'nOrg-node.tpl.html'">
      </span>
    </li>
  </ol>
</div>
