<div>
  <div class="input-prepend input-append">
    <span class="btn-group">
      <button type="button"
              class="btn cursor-button"
              title="Node cursor"
              ng:class="{'btn-primary': node.$cursor,
                        'btn-default': ! node.$cursor}"
              ng:focus="node.cursorTo()">
        <span class="icon-th">
        </span>
      </button>
      <button type="button"
              class="btn btn-default collapse-button"
              title="Expand/Collapse this node's children"
              ng:disabled="! node.$length"
              ng:click="node.$collapsed = !node.$collapsed"
              ng:focus="node.cursorTo()">
        <span ng:class="{'icon-chevron-down': node.$length && node.$collapsed,
                        'icon-chevron-up': !(node.$length && node.$collapsed),
                        'icon-chevron-up': !(node.$length && node.$collapsed),
                        'muted': ! node.$length}">
        </span>
      </button>
      <button type="button"
              class="btn btn-default headers-expand"
              title="Expand/Collapse headers/fields"
              ng:disabled="! node.headers['NOrg-User-Headers'].length"
              ng:click="node.headers.$collapsed = !node.headers.$collapsed"
              ng:focus="node.cursorTo()">
        <span class="icon-th-list"
              ng:class="{'text-muted':
                        ! node.headers['NOrg-User-Headers'].length}">
        </span>
      </button>
      <button type="button"
              class="btn btn-default node-select"
              title="Select this node for multi-node actions"
              ng:focus="node.cursorTo()">
        <input type="checkbox" name="Message-ID-{{node.toId()}}"
               ng:focus="node.cursorTo()" />
      </button>
    </span>

    <input type="text" class="norg-node-subject input-xxlarge"
           name="Message-ID-{{node.toId()}}-headers-Subject"
           ng:model="node.headers['Subject']"
           norg:focus="{{node.$cursor}}" />

    <span class="btn-group">
      <button type="button"
              class="btn btn-default add"
              title="Add a new node"
              ng:click="node.newSibling({}, $event)">
        <span class="icon-plus"></span>
      </button>
      <button type="button"
              class="btn btn-default promote"
              title="Promote this node"
              ng:disabled="! node.$parent.$parent"
              ng:click="node.promote()"
              ng:focus="node.cursorTo()">
        <span class="icon-arrow-left"
              ng:class="{'muted': ! node.$parent.$parent}"></span>
      </button>
      <button type="button"
              class="btn btn-default demote"
              title="Demote this node"
              ng:disabled="! node.$prevSibling"
              ng:click="node.demote()"
              ng:focus="node.cursorTo()">
        <span class="icon-arrow-right"
              ng:class="{'muted': ! node.$prevSibling}"></span>
      </button>
      <button type="button"
              class="btn btn-default promote"
              title="Promote this node"
              ng:disabled="! node.$prevSibling"
              ng:click="node.moveUp()"
              ng:focus="node.cursorTo()">
        <span class="icon-arrow-up"
              ng:class="{'muted': ! node.$prevSibling}"></span>
      </button>
      <button type="button"
              class="btn btn-default demote"
              title="Demote this node"
              ng:disabled="! node.$nextSibling"
              ng:click="node.moveDown()"
              ng:focus="node.cursorTo()">
        <span class="icon-arrow-down"
              ng:class="{'muted': ! node.$nextSibling}"></span>
      </button>
    </span>
  </div>

  <div id="Message-ID-{{node.toId()}}-headers"
       class="norg-headers"
       collapse="node.headers.$collapsed">
    <div class="row-fluid"
         ng:repeat="(index, key) in node.headers['NOrg-User-Headers']">
      <div class="input-prepend">
        <button type="button"
                class="btn cursor-button"
                ng:class="{'btn-primary': (node.headers.$cursor && (node.$cursorIndex == index)),
                          'btn-default': ! (node.headers.$cursor && (node.$cursorIndex == index))}"
                title="Node cursor"
                ng:click="node.cursorTo(node.headers, index)">
          <span class="icon-th">
          </span>
        </button>
        <input type="text" class="norg-headers-key"
               name="Message-ID-{{node.toId()}}-header-key-{{key}}"
               ng:model="key"
               ng:focus="node.cursorTo(node.headers, index)" />
      </div>
      <div class="input-append">
        <input type="text" class="input-xlarge"
               name="Message-ID-{{node.toId()}}-header-value-{{key}}"
               ng:model="node.headers[key]"
               ng:focus="node.cursorTo(node.headers, index)"
               norg:focus="{{node.headers.$cursor &&
                             (node.$cursorIndex == index)}}" />
      </div>
    </div>
  </div>

  <ol id="children" class="norg-nodes" collapse="node.$collapsed">
    <li ng:repeat="node in node.children()"
        ui:keydown="keydown"
        id="Message-ID-{{node.toId()}}"
        class="norg-node row-fluid">
      <span ng:include="'nOrg-node.tpl.html'">
      </span>
    </li>
  </ol>
</div>
